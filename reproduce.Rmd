---
title: "Reproducing Main Results in “GS-BART: Bayesian Additive Regression Trees with Graph-split Decision Rules for Generalized Spatial Nonparametric Regressions”"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, cache = FALSE)
library(ggplot2)
```

## Introduction

This document reproduces main simulation and real data application (Section 5) results in "GS-BART: Bayesian Additive Regression Trees with Graph-split Decision Rules for Generalized Spatial Nonparametric Regressions"

By default, this document generates figures and tables from pre-computed results to save computation time. To re-run model fitting and prediction of GS-BART, change the following options accordingly, and then re-compile this R Markdown document. Please note that it can take serveral hours to re-run GS-BART.

```{r options, echo = TRUE}
# NOTE: Re-running models can take several hours.
sim_continuous_fit = FALSE # whether to re-run GS-BART model for continuous-response simulation data
sim_count_fit = FALSE # whether to re-run GS-BART model for count-response simulation data 
sim_classification_fit = FALSE # whether to re-run GS-BART model for classification simulation data 

real_continuous_fit = FALSE # whether to re-run GS-BART model for continuous-response real data
real_count_fit = FALSE # whether to re-run GS-BART model for count-response real data 
real_classification_fit = FALSE # whether to re-run GS-BART model for classification real data 
```

```{r excluded_vars}
# variable names to keep in the environment (not to be cleared)
excluded_vars = c(
  "sim_continuous_fit", "sim_count_fit", "sim_classification_fit", 
  "real_continuous_fit", "real_count_fit", "real_classification_fit", 
  "excluded_vars"
)
```

## Main Results in Simulation Studies

```{r sim_continuous_fit}
if (sim_continuous_fit) {
  message("Re-running GS-BART model for continuous-response simulation data...")

  rm(list = setdiff(ls(), excluded_vars))
  source("R/sim_continuous_fit_model.R")

} else {
  message("Loading pre-computed GS-BART model for count simulation data..")
}
```

```{r sim_count_fit}
if (sim_count_fit) {
  message("Re-running GS-BART model for count-response simulation data...")

  rm(list = setdiff(ls(), excluded_vars))
  source("R/sim_count_fit_model.R")

} else {
  message("Loading pre-computed GS-BART model for count simulation data..")
}
```

```{r sim_classification_fit}
if (sim_classification_fit) {
  message("Re-running GS-BART model for classification simulation data...")

  rm(list = setdiff(ls(), excluded_vars))
  source("R/sim_classification_fit_model.R")

} else {
  message("Loading pre-computed GS-BART model for classification simulation data..")
}
```

```{r reproduce_sim}
rm(list = setdiff(ls(), excluded_vars))
message("Reproducing simulation results...")
# generate figures and tables
source("R/GSBART_sim_results.R")
```

### Table 1 (Continuous)

```{r table_1}
knitr::kable(table_1, digits = 3)
```

### Table 1 (Count)

```{r table_2}
knitr::kable(table_2, digits = 3)
```

### Table 1 (Classification)

```{r table_3}
knitr::kable(table_3, digits = 3)
```

### Figure 3 (A)

```{r figure_1, fig.height = 3, fig.width = 6}
print(figure_1)
```

### Figure 3 (B)

```{r figure_2, fig.height = 4, fig.width = 4}
print(figure_2)
```

### Figure S6

```{r figure_3, fig.height = 4, fig.width = 4}
print(figure_3)
```


## Main Results in Real Data Analysis

This section reproduces main results in the precipitation real data analysis.

```{r real_continuous_fit}
if (real_continuous_fit) {
  message("Re-running GS-BART model for continuous-response real data...")

  rm(list = setdiff(ls(), excluded_vars))
  source("R/real_continuous_fit_model.R")

} else {
  message("Loading pre-computed GS-BART model for continuous real data..")
}
```

```{r real_count_fit}
if (real_count_fit) {
  message("Re-running GS-BART model for count-response real data...")

  rm(list = setdiff(ls(), excluded_vars))
  source("R/real_count_fit_model.R")

} else {
  message("Loading pre-computed GS-BART model for count real data..")
}
```

```{r real_classification_fit}
if (real_classification_fit) {
  message("Re-running GS-BART model for classification real data...")

  rm(list = setdiff(ls(), excluded_vars))
  source("R/real_classification_fit_model.R")

} else {
  message("Loading pre-computed GS-BART model for classification real data..")
}
```

```{r reproduce_app}
rm(list = setdiff(ls(), excluded_vars))
message("Reproducing real data analysis results...")
# generate figures and tables
source("R/GSBART_real_results.R")
```

### Table 2 (Continuous)

```{r table_4}
knitr::kable(table_4, digits = 3)
```

### Table 2 (Count)

```{r table_5}
knitr::kable(table_5, digits = 3)
```

### Table 2 (Classification)

```{r table_6}
knitr::kable(table_6, digits = 3)
```

### Figure 4

```{r figure_4, fig.height = 5, fig.width = 5}
print(figure_4)
```

### Figure S7

```{r figure_5, fig.height = 5, fig.width = 10}
print(figure_5)
```